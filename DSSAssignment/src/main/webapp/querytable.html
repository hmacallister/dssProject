<!DOCTYPE html>
<html ng-app>
	<head>

		<meta charset="ISO-8859-1">
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src="http://www.shawnolson.net/scripts/public_smo_scripts.js"></script>

		<title>Query Viewer</title>
		<script type="text/javascript" id="me">
			//var name = window.name;
			//elem.style.color = 'red';
			
			//var code = name.substring(0, 3);
		</script>
		
    
    
	</head>
	<body ng-controller="errorLoader">
		<div id="wrapper">
		<div id="page-wrapper">

        <h2 align="center">Tracks</h2>
		<div class="table-responsive">
		<table id="errorViewer" class="table table-bordered table-hover table-striped">
			<thead>
				<tr>
					<th class="id">Id</th>
					<th class="title">Title</th>
					<th class="artist">Artist</th>
					<th class="album">Album</th>
					<th class="genre">Genre</th>
					<th class="trackId">Track Id</th>
					<th class="userID">User Id</th>
					<th class="noCode">Query Result Table</th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="record in records">
					<td class="id">{{record[0]}}</td>
					<td class="title">{{record[1]}}</td>
					<td class="artist">{{record[2]}}</td>
					<td class="album">{{record[3]}}</td>
					<td class="genre">{{record[4]}}</td>
					<td class="trackId">{{record[5]}}</td>
					<td class="userID">{{record[6]}}</td>
				</tr>
			</tbody>
		</table>
		</div><!-- end table-responsive -->
		</div>
		</div>


		<script>
			function errorLoader($scope, $http) {
				console.log("name is: "+name);
				var choice = readCookie('choicecookie')
				//alert(choice);
				if(choice == 1){
					var x = readCookie('usercookie')
					var libraryPersistentID = x.split('libraryPersistentID":"');		
					var userID = libraryPersistentID[1].substring(0,libraryPersistentID[1].length-2);
					//alert(userID);
					$http.get('/dss/rest/tracks/getlibrary/'+ userID).
			        success(function(data) {
			            $scope.records = data;
			        });
			        
				   // window.top.name = "";	
				}				
				else{
					$http.get('/dss/rest/playlists/getplaylistbytitle/' + choice).
			        success(function(data) {
			            $scope.records = data;
			        });
			        
				  //  window.top.name = "";
				}
				
			}
		</script>

		<script>
							
			var x = readCookie('usercookie')
			if (!x) {
				window.location.replace("/dss/login.html");
			}

			function readCookie(name) {
				var nameEQ = name + "=";
				var ca = document.cookie.split(';');
				for (var i = 0; i < ca.length; i++) {
					var c = ca[i];
					while (c.charAt(0) == ' ')
					c = c.substring(1, c.length);
					if (c.indexOf(nameEQ) == 0) {
						return c.substring(nameEQ.length, c.length);
					}
				}
				return null;
			}
			function createCookie(name, value, days) {
				if (days) {
					var date = new Date();
					date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
					var expires = "; expires=" + date.toGMTString();
				} else
					var expires = "";
				document.cookie = name + "=" + value + expires + "; path=/";
			}

			function eraseCookie(name) {
				createCookie(name, "", -1);
				if(name == "usercookie"){
					window.location.replace("/dss/login.html");
				}
				
			}
		</script>
		   
    
	</body>
</html>